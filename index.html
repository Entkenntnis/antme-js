<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="utf-8">
        <title>Loading Ant model!</title>
        <style>
            body { margin: 0}
            canvas { width:100%; height:100% }
        </style>
    </head>
    <body>
        <script src="js/THREE.js"></script>
        <script src="js/orbit.js"></script>
        <script src="js/tween.js"></script>
        <script src="js/stats.min.js"></script>
        <script>
"use strict";

// encapsulate our project
(function(global){
  
  // project-wide variables
  var scene, camera, renderer, stats, controls;
  
  function init(){
    // our stage
    scene = new THREE.Scene();
    
    // the floor lies in the xz-plane, don't worry about aspect here, will be done on resize 
    var camera = new THREE.PerspectiveCamera(60, 1 /*aspect*/, 0.1, 10000);
    camera.position.set(0, 2, 120);
    
    // the worker in the shadow
    var renderer = new THREE.WebGLRenderer();
    document.body.appendChild(renderer.domElement);
    
    // showing nice fps
    var stats = new Stats();
    stats.showPanel( 0 ); // 0: fps, 1: ms, 2: mb, 3+: custom
    document.body.appendChild( stats.dom );
    
    // making it awesome fullwindow
    window.addEventListener('resize', resize, false);
    resize();
    
    // getting things piped over
    loadObjs(); 
  }
  
  function buildEnv(){
  
  }
  
  function resize() {
    var w = document.documentElement.clientWidth;
    var h = document.documentElement.clientHeight;
    renderer.setSize(w, h);
    camera.aspect = w/h;
    camera.updateProjectionMatrix();
  }

  function animate(e){
    stats.begin();
    renderer.render(scene, camera);
    stats.end();
    requestAnimationFrame(animate);
  }


})();




            
            
            var manager = new THREE.LoadingManager();
            var scene = new THREE.Scene();
    var camera = new THREE.PerspectiveCamera(60, 1, 0.1, 10000);
    camera.position.z = 100;
    camera.position.y = 1;
            
            var renderer = new THREE.WebGLRenderer();
            document.body.appendChild(renderer.domElement);
            var texLoader = new THREE.TextureLoader(manager);
            
            var stats = new Stats();
            stats.showPanel( 0 ); // 0: fps, 1: ms, 2: mb, 3+: custom
            document.body.appendChild( stats.dom );
            
            // objects
            var eyes = [];
            var ant = undefined;
            var objectLoader = new THREE.ObjectLoader(manager);
				    objectLoader.load("models/ant.json", function ( obj ) {
				      obj.children[0].children.forEach(function(o){
				        o.material = new THREE.MeshPhongMaterial({color:0x0d0d0d});
				      });
				      var body = obj.children[0].children[6];
				      body.material = new THREE.MeshPhongMaterial({color:0xff0000});
				      ant = obj;
				     	scene.add( obj);
				    } );
				    objectLoader.load("models/anthill.json", function ( obj ) {
				      var earthTexture = texLoader.load( "assets/earth.jpg" );
				      var mat = new THREE.MeshPhongMaterial({color:0x663300});
				      mat.map = earthTexture;
				      obj.children[0].children[1].material = mat;
				      obj.children[0].children[0].material = new THREE.MeshPhongMaterial({color:0x000000});
				      obj.children[0].children[2].material = new THREE.MeshPhongMaterial({color:0xff0000});
				      obj.position.set(60, 0, 0);
				     	scene.add( obj );
				    } );
				    
				    objectLoader.load("models/apple.json", function ( obj ) {
				      obj.children[0].children[0].material = new THREE.MeshPhongMaterial({color:0x00cc00});
				      obj.children[0].children[1].material = new THREE.MeshPhongMaterial({color:0x669900});
				      obj.position.set(-50, 0, 0);
				     	scene.add( obj );
				    } );
				    objectLoader.load("models/bug.json", function ( obj ) {
				      obj.children[0].children.forEach(function(o){
				        o.material = new THREE.MeshPhongMaterial({color:0x000000,specular:0x00dddd});
				      });
				      eyes.push(obj.children[0].children[7]);
				      eyes.push(obj.children[0].children[6]);
				      obj.position.set(-10, 0, -20);
				     	scene.add( obj );
				    } );
				    
				    objectLoader.load("models/sugar.json", function ( obj ) {
				      obj.position.set(0, 0, -100);
				      obj.children[0].children[0].material = new THREE.MeshPhongMaterial({color:0xffffff});
				     	scene.add( obj );
				    } );
				    
				    //floor
				    var faceMat = new THREE.MeshBasicMaterial({color: 0x888888,side: THREE.DoubleSide});
            
	          var floorTexture = texLoader.load( "assets/sand.jpg" );
	          floorTexture.wrapS = THREE.RepeatWrapping;
            floorTexture.wrapT = THREE.RepeatWrapping;
	          floorTexture.repeat.set(4, 4);
	          faceMat.map = floorTexture;
	          var floor=new THREE.Mesh(new THREE.PlaneGeometry(1000, 1000, 1, 1),faceMat);
	
	          floor.rotation.x = Math.PI / 2;
	          scene.add(floor);
	          
	          //skybox
	          var materialArray = [];
            materialArray.push(new THREE.MeshBasicMaterial( { map: texLoader.load( 'images/dawnmountain-xpos.png' ) }));
            materialArray.push(new THREE.MeshBasicMaterial( { map: texLoader.load( 'images/dawnmountain-xneg.png' ) }));
            materialArray.push(new THREE.MeshBasicMaterial( { map: texLoader.load( 'images/dawnmountain-ypos.png' ) }));
            materialArray.push(new THREE.MeshBasicMaterial( { map: texLoader.load( 'images/dawnmountain-yneg.png' ) }));
            materialArray.push(new THREE.MeshBasicMaterial( { map: texLoader.load( 'images/dawnmountain-zpos.png' ) }));
            materialArray.push(new THREE.MeshBasicMaterial( { map: texLoader.load( 'images/dawnmountain-zneg.png' ) }));
            for (var i = 0; i < 6; i++)
               materialArray[i].side = THREE.BackSide;
            var skyboxMaterial = new THREE.MeshFaceMaterial( materialArray );
            var skyboxGeom = new THREE.CubeGeometry( 5000, 5000, 5000, 1, 1, 1 );
            var skybox = new THREE.Mesh( skyboxGeom, skyboxMaterial );
            scene.add( skybox );
            
            //directional light
    				var ambient = new THREE.AmbientLight( 0x444444 );
				    scene.add( ambient );
				    var directionalLight = new THREE.DirectionalLight( 0xffeedd );
				    directionalLight.position.set( 1, 2, 3 ).normalize();
				    scene.add( directionalLight );
            
            
            window.addEventListener('resize', resize, false);
            
            function resize() {
                var w = document.documentElement.clientWidth;
                var h = document.documentElement.clientHeight;
                renderer.setSize(w, h);
                camera.aspect = w/h;
                camera.updateProjectionMatrix();
            }
            
            resize();
            
            
            var controls = new THREE.OrbitControls(camera);
            controls.maxPolarAngle = Math.PI/2;
            controls.maxDistance = 1500;
            
            //blinking eyes
            loaded();
            function loaded(){
              if (eyes.length <= 0) {
                setTimeout(loaded, 100);
                return;
              }
              eyes.forEach(function(eye){
                createjs.Tween.get(eye.material.color, {loop:true}).to({r:1},1000).to({r:0},1000);
              });
            }
            
            //moving ant
            initAnt();
            function initAnt(){
              if (ant == undefined) {
                setTimeout(initAnt, 100);
                return;
              }
                moveLeft();
            }
            function moveLeft(){
              ant.rotation.y = Math.PI/4;
              createjs.Tween.get(ant.position).to({x:-100,z:100}, 2000).call(moveRight);
            }
            function moveRight(){
              ant.rotation.y = Math.PI/4*5;
              createjs.Tween.get(ant.position).to({x:0,z:0}, 2000).call(moveLeft);
            }
            
            manager.onLoad = render;
            function render(e){
              stats.begin();
                renderer.render(scene, camera);
                stats.end();
                requestAnimationFrame(render);
            }
            
        </script>
        <div style="position: absolute; z-index: 1; left: 50px; top: 50px; width:400px; height:30px;font-size:2em">
	<p>Click/drag to rotate. Mouse wheel to zoom.</p>
</div>
    </body>
</html>
